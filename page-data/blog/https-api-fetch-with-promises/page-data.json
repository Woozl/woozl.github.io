{"componentChunkName":"component---src-pages-mdx-slug-tsx","path":"/blog/https-api-fetch-with-promises/","result":{"data":{"mdx":{"frontmatter":{"title":"HTTPS API Fetch with Promises","date":"June 21st, 2022","summary":"Using promises to write readable, error handled API requests.","thumb":null},"timeToRead":5,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"HTTPS API Fetch with Promises\",\n  \"date\": \"2022-06-21\",\n  \"summary\": \"Using promises to write readable, error handled API requests.\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"why-use-promises\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#why-use-promises\",\n    \"aria-label\": \"why use promises permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Why use promises?\"), mdx(\"p\", null, \"Promises are a feature in Javascript that assist in handling asynchronous operations, especially multiple operations. Instead of using seperate callbacks functions for error and success states, use of promises leads to clearer control flow, less coupled code, and integrated error handling.\"), mdx(\"h2\", {\n    \"id\": \"writing-a-simple-promise\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#writing-a-simple-promise\",\n    \"aria-label\": \"writing a simple promise permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Writing a simple promise\"), mdx(\"p\", null, \"The Promise constructor has a callback function to handle the activities of the promise. This function is passed two arguments--a resolve function and a reject function. We can call resolve or reject when we have fulfilled or failed the promise.\"), mdx(\"p\", null, \"Have a look at a very basic promise:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"let promise = new Promise((resolve, reject) => {\\n    if(1 === 1)\\n        resolve(`Success!`);\\n    else\\n        reject(`Error`);\\n});\\n\")), mdx(\"p\", null, \"In the code above, we call resolve if \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1===1\"), \" and reject if it does not. You will also notice that resolve and reject are called with a value. Lets see what happens with this value when we call the promise.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"promise\\n    .then(value => console.log(value))\\n    .catch(value => console.log(value))\\n\")), mdx(\"p\", null, \"The value that was passed into the callback functions is provided in the then and catch statements on the promise. If we run this code, we get:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"Success!\\n\")), mdx(\"p\", null, \"The benefit in writing asynchronous code like this is that multiple promises can be chained together and performed sequentially. Additionally, our error handling for all of the promises can be caught at the end of the chain.\"), mdx(\"h2\", {\n    \"id\": \"making-a-pbj-sandwich\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#making-a-pbj-sandwich\",\n    \"aria-label\": \"making a pbj sandwich permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Making a PB&J Sandwich\"), mdx(\"p\", null, \"Typically promises are not written as variables, but returned from a function. The following code demonstrates building a peanut butter and jelly sandwich using promises:\"), mdx(\"h3\", {\n    \"id\": \"running-this-code\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#running-this-code\",\n    \"aria-label\": \"running this code permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Running this code\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Make sure you have \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://nodejs.dev/\"\n  }, \"Node\"), \" and npm installed\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Download ts-node \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"npm i -g ts-node\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Run the file \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ts-node script.ts\"))), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Note: I am using Typescript. If you are just using Javascript, you can remove the type annotations.\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"const haveBread = true;\\nconst havePB = true;\\nconst haveJelly = true;\\n\\nfunction getBread() {\\n    return new Promise<string[]>((resolve, reject) => {\\n        if(haveBread)\\n            resolve(['bread', 'bread']);\\n        else\\n            reject('No bread!')\\n    });\\n}\\n\\nfunction putOnPeanutButter(sandwich: string[]) {\\n    return new Promise<string[]>((resolve, reject) => {\\n        if(havePB) {\\n            sandwich.splice(1, 0, 'PB')\\n            resolve(sandwich);\\n        }\\n        else\\n            reject('No peanut butter!')\\n    });\\n}\\n\\nfunction putOnJelly(sandwich: string[]) {\\n    return new Promise<string[]>((resolve, reject) => {\\n        if(haveJelly) {\\n            sandwich.splice(2, 0, 'jelly');\\n            resolve(sandwich);\\n        }\\n        else\\n            reject('No jelly!')\\n    });\\n}\\n\\ngetBread()\\n    .then(putOnPeanutButter)\\n    .then(putOnJelly)\\n    .then(console.log)\\n    .catch(console.log);\\n\")), mdx(\"p\", null, \"When run, this code will print \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"[ 'bread', 'PB', 'jelly', 'bread' ]\"), \". You can see how functions that return promises can improve the readability of the code. We simply chain \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"then\"), \" statements until we finish. Once the promise chain has finished, we can do whatever we wish with the value (here we simply pass it to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"console.log\"), \").\"), mdx(\"p\", null, \"Additionally, if there is any error in the chain, the chain breaks and goes to the catch statement. Try changing the boolean values at the top of the script. Whichever promise fails first passes it's \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"reject\"), \" value to the catch function.\"), mdx(\"p\", null, \"This is a good example showing chained promises, but this code is not asynchronous. All of the operations used in constructing the sandwich are fast and could be implemented using normal, synchronous code. Promises really shine in cases where code takes much longer to run, such as waiting for a response from a database, or downloading an image from a website. Promises allow the rest of our code to keep running, and only be interrupted once the promise has been resolved. If you are interested in learning more about how Javascript processes instructions and events, I recommend you read about the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop\"\n  }, \"event loop\"), \".\"), mdx(\"h2\", {\n    \"id\": \"fetching-data-from-an-api-with-https-get-request\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#fetching-data-from-an-api-with-https-get-request\",\n    \"aria-label\": \"fetching data from an api with https get request permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Fetching data from an API with HTTPS GET request\"), mdx(\"p\", null, \"To demonstrate a real world use case of promises, lets write some code that gets JSON from an HTTPS address.\"), mdx(\"p\", null, \"There is a list of free public APIs on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/public-apis/public-apis\"\n  }, \"this Github repository\"), \". For this example, I decided to use Mojang's API to download a Minecraft skin. The way the code should work, the user should provide their username, and the image of their profile's skin should be downloaded.\"), mdx(\"p\", null, \"This \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://mojang-api-docs.netlify.app/index.html\"\n  }, \"website\"), \" provides some documentation for Mojang's APIs. There isn't a single endpoint that gets the skin image from the username, so we first have to get the users UUID, and then get the profile from that. The profile will contain the url to the skin. So the order of operations is\"), mdx(\"p\", null, \"Username -> UUID -> Profile -> Image URL -> Download Image\"), mdx(\"p\", null, \"All of the operations are GET requests, meaning we don't have to pass a header, we just put the information we want in the requested URL.\"), mdx(\"h3\", {\n    \"id\": \"getting-the-uuid-from-the-username\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#getting-the-uuid-from-the-username\",\n    \"aria-label\": \"getting the uuid from the username permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Getting the UUID from the Username\"), mdx(\"p\", null, \"Making a GET request to the following address with a valid username returns a JSON object with the name and id parameters:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"GET https://api.mojang.com/users/profiles/minecraft/{username}\\n\")), mdx(\"p\", null, \"There are lots of different methods of making https requests. If you are running code in a browser, you can use the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch\"\n  }, \"Fetch API\"), \". Since I am using Node, I decided to use the built in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"https\"), \"/\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http\"), \" standard libraries, but there are plenty of libraries to use, such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node-fetch\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"axios\"), \".\"), mdx(\"p\", null, \"Using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"https\"), \" library to GET an object looks like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"import https from 'https';\\n\\nhttps.get('https://api.mojang.com/users/profiles/minecraft/WoozleG', res => {\\n    let chunk = '';\\n    res.on('data', data => chunk += data);\\n    res.on('end', () => console.log(JSON.parse(chunk)));\\n}).on('error', console.log);\\n\")), mdx(\"p\", null, \"Which prints:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"{ name: 'WoozleG', id: '95724006d8a7469ca90e77e026d95541' }\\n\")), mdx(\"p\", null, \"A couple things to note:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The data stream is continuously added to the chunk variable and then dealt with once the stream has ended.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"We have to parse the chunk into a valid JSON object to access the properities on it.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The error is logged if there is anything wrong with the request.\")), mdx(\"p\", null, \"Now, lets promisify it and add some additional features: \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"function getUuid(profileName: string) {\\n    const getUuidUrl = (profileName: string) => `https://api.mojang.com/users/profiles/minecraft/${profileName}`;\\n    \\n    return new Promise<string>((resolve, reject) => {\\n        https.get(getUuidUrl(profileName), response => {\\n            if(response.statusCode === 200) {\\n                let chunk = '';\\n                response.on('data', data => chunk += data);\\n                response.on('end', () => resolve(JSON.parse(chunk).id));\\n            }\\n            else {\\n                reject(`UUID fetch was invalid with status code ${response.statusCode}`);\\n            }\\n        }).on('error', reject);\\n    });\\n}\\n\")), mdx(\"p\", null, \"Now the request is a function called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getUuid\"), \" that returns a promise. The helper function \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getUuidUrl\"), \" takes a profile name string and returns the the correct URL string. Now that our HTTPS request is inside a promise, all of our error cases are handled with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"reject\"), \". For example, if there was an error with the request, or the response returned a status code other than 200 (OK). Also, now we are using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"resolve\"), \" method to pass on the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"id\"), \" property of our JSON object to the next promise in the chain.\"), mdx(\"p\", null, \"Now we can call:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"getUuid('WoozleG')\\n    .then(console.log)\\n    .catch(console.log);\\n\")), mdx(\"p\", null, \"The value of the resolve function (the UUID) is passed to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"console.log\"), \" function in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"then\"), \". However, if we input an invalid username, Mojang's server will return a status code other than 200, and our reject function will pass it's value to the log function in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"catch\"), \", returning...\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"UUID fetch was invalid with status code 204\\n\")), mdx(\"h2\", {\n    \"id\": \"getting-the-profile-from-the-uuid\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#getting-the-profile-from-the-uuid\",\n    \"aria-label\": \"getting the profile from the uuid permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Getting the Profile from the UUID\"), mdx(\"p\", null, \"Now that we have the UUID, we can request the users profile information from a different HTTPS endpoint. This time we can make a GET request to the following address:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"https://sessionserver.mojang.com/session/minecraft/profile/{UUID}\\n\")), mdx(\"p\", null, \"Passing in a valid UUID returns a JSON object that looks like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"{\\n  \\\"id\\\" : \\\"95724006d8a7469ca90e77e026d95541\\\",\\n  \\\"name\\\" : \\\"WoozleG\\\",\\n  \\\"properties\\\" : [ {\\n    \\\"name\\\" : \\\"textures\\\",\\n    \\\"value\\\" : \\\"ewogICJ0aW1lc3RhbXAiIDogMTY1NTkxMzQ4MjExOSwKICAicHJvZmlsZUlkIiA6ICI5NTcyNDAwNmQ4YTc0NjljYTkwZTc3ZTAyNmQ5NTU0MSIsCiAgInByb2ZpbGVOYW1lIiA6ICJXb296bGVHIiwKICAidGV4dHVyZXMiIDogewogICAgIlNLSU4iIDogewogICAgICAidXJsIiA6ICJodHRwOi8vdGV4dHVyZXMubWluZWNyYWZ0Lm5ldC90ZXh0dXJlLzdjYThiMTk2Y2NjZWM5Y2U1MDU5MmRiMWJiNTA4OGY3ZDAwMDM4MTNmZDU5ZTVmNzhlMTcxMmY0MjhlNTZiN2EiCiAgICB9LAogICAgIkNBUEUiIDogewogICAgICAidXJsIiA6ICJodHRwOi8vdGV4dHVyZXMubWluZWNyYWZ0Lm5ldC90ZXh0dXJlLzIzNDBjMGUwM2RkMjRhMTFiMTVhOGIzM2MyYTdlOWUzMmFiYjIwNTFiMjQ4MWQwYmE3ZGVmZDYzNWNhN2E5MzMiCiAgICB9CiAgfQp9\\\"\\n  } ]\\n}\\n\")), mdx(\"p\", null, \"The long string for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"value\"), \" is a base64 encoded JSON object that contains the picture information we need to get the skin. We will come back to that in the next step, first let's write another function to get this data. It will look almost identical to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getUuid\"), \" function:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"function getProfile(uuid: string) {\\n    const getProfileUrl = (uuid: string) => `https://sessionserver.mojang.com/session/minecraft/profile/${uuid}`;\\n\\n    return new Promise((resolve, reject) => {\\n        https.get(getProfileUrl(uuid), response => {\\n            if(response.statusCode === 200) {\\n                let chunk = '';\\n                response.on('data', data => chunk += data);\\n                response.on('end', () => resolve(JSON.parse(chunk)));\\n            }\\n            else {\\n                reject(`Profile fetch was invalid with status code ${response.statusCode}`);\\n            }\\n        }).on('error', reject);\\n    });\\n}\\n\")), mdx(\"h2\", {\n    \"id\": \"getting-the-skin-url-from-the-encoded-string\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#getting-the-skin-url-from-the-encoded-string\",\n    \"aria-label\": \"getting the skin url from the encoded string permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Getting the skin URL from the encoded string\"), mdx(\"p\", null, \"Now that we have the profile object, we need to decode the long string into another JSON object. Thankfully, Node has a standard object called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Buffer\"), \" that can be used to do different types of encoding and decoding on data streams. The specific type of encoding used is base64, which is pretty common for data transmission over networks. You can read more about it \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Glossary/Base64\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"In the example from the previous section, the long string decoded looks like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"{\\n  \\\"timestamp\\\" : 1655914887815,\\n  \\\"profileId\\\" : \\\"95724006d8a7469ca90e77e026d95541\\\",\\n  \\\"profileName\\\" : \\\"WoozleG\\\",\\n  \\\"textures\\\" : {\\n    \\\"SKIN\\\" : {\\n      \\\"url\\\" : \\\"http://textures.minecraft.net/texture/7ca8b196cccec9ce50592db1bb5088f7d0003813fd59e5f78e1712f428e56b7a\\\"\\n    },\\n    \\\"CAPE\\\" : {\\n      \\\"url\\\" : \\\"http://textures.minecraft.net/texture/2340c0e03dd24a11b15a8b33c2a7e9e32abb2051b2481d0ba7defd635ca7a933\\\"\\n    }\\n  }\\n}\\n\")), mdx(\"p\", null, \"We only need the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"textures.SKIN.url\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"profileName\"), \".\"), mdx(\"p\", null, \"The following code creates a new Buffer with the decoded data, and then converts it to a string representation, which is then parsed into an actual JSON object.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"function saveSkin(profile: any) {\\n    const textureObjectBuffer = Buffer.from(profile.properties[0].value, 'base64url');\\n    const textureObject = JSON.parse(textureObjectBuffer.toString('ascii'));\\n\\n    const profileName = textureObject.profileName;\\n    const skinUrl = textureObject.textures.SKIN.url;\\n\\n    return downloadImageFromUrl(skinUrl, `./${profileName}.png`);\\n}\\n\")), mdx(\"p\", null, \"We then grab the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"profileName\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"skinUrl\"), \" from the object. Then another promise is returned by \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"downloadImageFromUrl\"), \", which saves the image from the URL into a file in the same directory with the profile name.\"), mdx(\"h2\", {\n    \"id\": \"download-the-image-from-the-url\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#download-the-image-from-the-url\",\n    \"aria-label\": \"download the image from the url permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Download the Image from the URL\"), mdx(\"p\", null, \"Lets finish by implementing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"downloadImageFromUrl\"), \" function. This function returns a promise that resolves when the image has finished downloading. Once again, this code is almost identical to the previous HTTPS requests:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"function downloadImageFromUrl(url: string, filepath: string) {\\n    return new Promise((resolve, reject) => {\\n        http.get(url, response => {\\n            if(response.statusCode === 200)\\n                response.pipe(fs.createWriteStream(filepath))\\n                .on('error', reject)\\n                .on('close', () => resolve(`File saved to ${filepath}`));\\n            \\n            else\\n                response.resume()\\n                .on('end', () => reject(`Downloading image failed with status code ${response.statusCode}`));\\n            \\n        }).on('error', reject);\\n    });\\n}\\n\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Note that this function uses HTTP instead of HTTPS. For some reason, Mojang's texture URLs are all unsecured. Otherwise, the code is no different than using HTTPS.\")), mdx(\"p\", null, \"The main difference in this code is that instead of storing the data in variable and converting it to JSON, we continuously \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pipe\"), \" the data into a new file. This is done with the standard Node library \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"fs\"), \". By calling \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"response.pipe(fs.createWriteStream(filepath))\"), \", we take the data as it is being downloaded and put it on our local machine at \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"filepath\"), \".\"), mdx(\"h2\", {\n    \"id\": \"bringing-it-all-together\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#bringing-it-all-together\",\n    \"aria-label\": \"bringing it all together permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Bringing it all together\"), mdx(\"p\", null, \"Finally, we can use all of our functions to write a promise chain:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"getUuid(\\\"WoozleG\\\")\\n    .then(getProfile)\\n    .then(saveSkin)\\n    .then(console.log)\\n    .catch(console.log);\\n\")), mdx(\"p\", null, \"The last promise, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"saveSkin\"), \" resolves with the message \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"File saved to ./WoozleG.png\"), \", if successful. If we open up the file, we can see the downloaded skin!\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"64px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"50%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACSklEQVQoz32ST0hUURTGv3Pu86mjM+OfnEodpaxVIMWIgkKbaJEYVNsogoIEFxJkEiKTiEpS1CIKFaIkChLaCBNk2aplYRuhICGEHNMptT9O8+a9L56jLVp44HAPnHs/ft85F6paYBmFUe0zRmlUMyKSUVWqSJ+IwL+jqtjKbcMXA8QvuwAQgC/mi1JUu3zB/3PbMKrXfLGqHXmvK8ptRiO2oyLOJuG0iHSr6lVVLfTpLMtsvAuHbFlNjgo5BvIB3LUb/wQJCMtLLU4OVnrtJ8t8SlqWeupTitIXF5Fgzq6PaCEcBH4t9oMcQXKuF59nL+bGYVSXQxZ+FwcKvYHLLU5zLLoCYCXPMo5RyYqoq6pLKlILQA+UiChsuyKIkg9vzpe8GDlhb7ntqfRRjgMNwNTE8BmukFMkN9s6DdlYUlZyI3CMauNmsykcDqed9Ns0uRB7/7wfs68GzSnfwES9JA7aWN5dV8XO1ublhTYk8vOtxM58pOoL/CWJl2e27MuMqCYAzARsm21HYtyzKzhXBJwuAVBticGfK4YvW8BzNtxHh8HUeIS2DdbX2JwfCHjhgNmYsai4/nmsVNhTLeyug3unBul4FHxyCEPPmoCJGCzwY6OzfrvM+9EJ8mmx923xklNUXOiEQrb3+G4rI+UFHgBvry3cB2TvH4XDOLJrgxZ5L5JZvy50R6SXDw3cUWPBc2fofh8jU8Nk6hZ/Lr1jtKKUuT+Zo2sICsf3CydrwU83Y+RqB935C3STQxlvMc7sl7Px7Nd2uMkO6y8BbO5bdxOZNQAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Minecraft Skin\",\n    \"title\": \"Minecraft Skin\",\n    \"src\": \"/static/87ec6ff99f84bc49d2bf990ddd91f0cc/6b377/WoozleG.png\",\n    \"srcSet\": [\"/static/87ec6ff99f84bc49d2bf990ddd91f0cc/6b377/WoozleG.png 64w\"],\n    \"sizes\": \"(max-width: 64px) 100vw, 64px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"h3\", {\n    \"id\": \"code\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#code\",\n    \"aria-label\": \"code permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Code\"), mdx(\"p\", null, \"You can view all the code together \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://gist.github.com/Woozl/fff1065677ec8c7c5c8da3556ee9a439\"\n  }, \"here\"), \". I set it up so that you can call it from the command line like so:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"ts-node download-minecraft-skin.ts {USERNAME}\\n\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Make sure you have \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"ts-node\"), \" installed globally!\")), mdx(\"h2\", {\n    \"id\": \"references\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#references\",\n    \"aria-label\": \"references permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"References\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises\"\n  }, \"Promises - MDN\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://mojang-api-docs.netlify.app/index.html\"\n  }, \"Unofficial Mojang API documentation\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://nodejs.dev/learn/making-http-requests-with-nodejs\"\n  }, \"Making HTTP requests with Node\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://stackoverflow.com/questions/14573001/nodejs-how-to-decode-base64-encoded-string-back-to-binary\"\n  }, \"Decode base64 with Node\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://scrapingant.com/blog/download-image-javascript\"\n  }, \"Download images with Node\"))));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"034bdc90-0579-5d4d-a9a5-96df0572009c","slug":"blog/https-api-fetch-with-promises/","__params":{"slug":"blog"}}},"staticQueryHashes":["3159585216","727183953"]}